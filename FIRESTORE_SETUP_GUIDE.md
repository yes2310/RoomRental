# Firebase Firestore ì´ˆê¸° ì„¤ì • ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” ë°©ë¹Œë¦¬ì ì•±ì—ì„œ Firebase Firestoreë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì´ˆê¸° ì„¤ì • ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨
1. [Firestore ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±](#1-firestore-ë°ì´í„°ë² ì´ìŠ¤-ìƒì„±)
2. [ë³´ì•ˆ ê·œì¹™ ì„¤ì •](#2-ë³´ì•ˆ-ê·œì¹™-ì„¤ì •)
3. [ì´ˆê¸° ë°ì´í„° ì¶”ê°€](#3-ì´ˆê¸°-ë°ì´í„°-ì¶”ê°€)
4. [ì¸ë±ìŠ¤ ìƒì„±](#4-ì¸ë±ìŠ¤-ìƒì„±)

---

## 1. Firestore ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±

### 1.1 Firebase Console ì ‘ì†
1. [Firebase Console](https://console.firebase.google.com/) ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. ì™¼ìª½ ë©”ë‰´ì—ì„œ **Firestore Database** í´ë¦­

### 1.2 ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
1. **ë°ì´í„°ë² ì´ìŠ¤ ë§Œë“¤ê¸°** ë²„íŠ¼ í´ë¦­
2. ìœ„ì¹˜ ì„ íƒ (ê¶Œì¥: `asia-northeast3` - ì„œìš¸)
3. **í…ŒìŠ¤íŠ¸ ëª¨ë“œì—ì„œ ì‹œì‘** ì„ íƒ (ë‚˜ì¤‘ì— í”„ë¡œë•ì…˜ ëª¨ë“œë¡œ ë³€ê²½ ê°€ëŠ¥)
4. **ì‚¬ìš© ì„¤ì •** í´ë¦­

---

## 2. ë³´ì•ˆ ê·œì¹™ ì„¤ì •

Firestore ë³´ì•ˆ ê·œì¹™ì„ ì„¤ì •í•˜ì—¬ ì‚¬ìš©ì ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ë¥¼ í•©ë‹ˆë‹¤.

### 2.1 ê·œì¹™ í¸ì§‘ê¸° ì—´ê¸°
1. Firestore Database í˜ì´ì§€ì—ì„œ **ê·œì¹™** íƒ­ í´ë¦­
2. ì•„ë˜ ê·œì¹™ì„ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ê¸°

### 2.2 ë³´ì•ˆ ê·œì¹™ ì½”ë“œ

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ì‚¬ìš©ì ì¸ì¦ í™•ì¸ í•¨ìˆ˜
    function isSignedIn() {
      return request.auth != null;
    }

    // ë¬¸ì„œ ì†Œìœ ì í™•ì¸ í•¨ìˆ˜
    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }

    // ê´€ë¦¬ì í™•ì¸ í•¨ìˆ˜ (ì´ë©”ì¼ ê¸°ë°˜)
    function isAdmin() {
      return isSignedIn() &&
             (request.auth.token.email == 'admin@bangbillija.com' ||
              request.auth.token.email == 'admin@example.com' ||
              request.auth.token.email == 'admin@admin.com');
    }

    // ê°•ì˜ì‹¤ ì»¬ë ‰ì…˜
    match /rooms/{roomId} {
      // ëˆ„êµ¬ë‚˜ ì½ê¸° ê°€ëŠ¥
      allow read: if isSignedIn();

      // ê´€ë¦¬ìë§Œ ì“°ê¸° ê°€ëŠ¥
      allow create, update, delete: if isAdmin();
    }

    // ì˜ˆì•½ ì»¬ë ‰ì…˜
    match /reservations/{reservationId} {
      // ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì½ê¸° ê°€ëŠ¥
      allow read: if isSignedIn();

      // ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ìƒì„± ê°€ëŠ¥
      allow create: if isSignedIn() &&
                    request.resource.data.userId == request.auth.uid;

      // ì†Œìœ ìë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
      allow update, delete: if isOwner(resource.data.userId);
    }
  }
}
```

### 2.3 ê·œì¹™ ê²Œì‹œ
1. **ê²Œì‹œ** ë²„íŠ¼ í´ë¦­
2. í™•ì¸ ëŒ€í™”ìƒìì—ì„œ **ê²Œì‹œ** í´ë¦­

---

## 3. ì´ˆê¸° ë°ì´í„° ì¶”ê°€

ì•±ì„ ì²˜ìŒ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ê°•ì˜ì‹¤ ë°ì´í„°ë¥¼ ë¨¼ì € ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

### 3.1 ê°•ì˜ì‹¤ ì»¬ë ‰ì…˜ ìƒì„±

1. **Firestore Database** â†’ **ë°ì´í„°** íƒ­
2. **ì»¬ë ‰ì…˜ ì‹œì‘** ë²„íŠ¼ í´ë¦­
3. ì»¬ë ‰ì…˜ ID: `rooms`

### 3.2 ìƒ˜í”Œ ê°•ì˜ì‹¤ ì¶”ê°€

#### ì²« ë²ˆì§¸ ê°•ì˜ì‹¤ (ê³µí•™ê´€ 301í˜¸)

**ë¬¸ì„œ ID:** `room301`

**í•„ë“œ:**
```
id: "room301" (string)
building: "ê³µí•™ê´€" (string)
name: "ê³µí•™ê´€ 301í˜¸" (string)
capacity: 40 (number)
floor: "3ì¸µ" (string)
facilities: ["í”„ë¡œì í„°", "ì™€ì´íŒŒì´", "í™”ì´íŠ¸ë³´ë“œ"] (array)
status: "AVAILABLE" (string)
createdAt: (í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„)
updatedAt: (í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„)
```

#### ë‘ ë²ˆì§¸ ê°•ì˜ì‹¤ (ê³µí•™ê´€ 205í˜¸)

**ë¬¸ì„œ ID:** `room205`

**í•„ë“œ:**
```
id: "room205" (string)
building: "ê³µí•™ê´€" (string)
name: "ê³µí•™ê´€ 205í˜¸" (string)
capacity: 30 (number)
floor: "2ì¸µ" (string)
facilities: ["í”„ë¡œì í„°", "í™”ì´íŠ¸ë³´ë“œ"] (array)
status: "AVAILABLE" (string)
createdAt: (í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„)
updatedAt: (í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„)
```

#### ì„¸ ë²ˆì§¸ ê°•ì˜ì‹¤ (ê³µí•™ê´€ 501í˜¸)

**ë¬¸ì„œ ID:** `room501`

**í•„ë“œ:**
```
id: "room501" (string)
building: "ê³µí•™ê´€" (string)
name: "ê³µí•™ê´€ 501í˜¸" (string)
capacity: 50 (number)
floor: "5ì¸µ" (string)
facilities: ["í”„ë¡œì í„°", "ì™€ì´íŒŒì´", "ìŠ¤í”¼ì»¤", "í™”ì´íŠ¸ë³´ë“œ"] (array)
status: "AVAILABLE" (string)
createdAt: (í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„)
updatedAt: (í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„)
```

### 3.3 ì˜ˆì•½ ì»¬ë ‰ì…˜ ìƒì„±

1. **Firestore Database** â†’ **ë°ì´í„°** íƒ­
2. **ì»¬ë ‰ì…˜ ì‹œì‘** ë²„íŠ¼ í´ë¦­
3. ì»¬ë ‰ì…˜ ID: `reservations`
4. (ì²˜ìŒì—ëŠ” ë¹ˆ ì»¬ë ‰ì…˜ìœ¼ë¡œ ë‘ê³ , ì•±ì—ì„œ ì˜ˆì•½ ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ì¶”ê°€ë¨)

---

## 4. ì¸ë±ìŠ¤ ìƒì„±

ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë³µí•© ì¸ë±ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### 4.1 ìë™ ì¸ë±ìŠ¤ ìƒì„±
ì•±ì„ ì‹¤í–‰í•˜ê³  ì˜ˆì•½ ëª©ë¡ì„ ì¡°íšŒí•˜ë©´, Firebaseê°€ ìë™ìœ¼ë¡œ í•„ìš”í•œ ì¸ë±ìŠ¤ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.

### 4.2 ìˆ˜ë™ ì¸ë±ìŠ¤ ìƒì„± (ì„ íƒì‚¬í•­)

1. **Firestore Database** â†’ **ì¸ë±ìŠ¤** íƒ­
2. **ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€** í´ë¦­

#### ì˜ˆì•½ ëª©ë¡ ì •ë ¬ìš© ì¸ë±ìŠ¤
- **ì»¬ë ‰ì…˜ ID:** `reservations`
- **í•„ë“œ:**
  - `userId` (ì˜¤ë¦„ì°¨ìˆœ)
  - `date` (ë‚´ë¦¼ì°¨ìˆœ)
  - `startTime` (ë‚´ë¦¼ì°¨ìˆœ)

#### ìƒíƒœë³„ ì˜ˆì•½ ì¡°íšŒìš© ì¸ë±ìŠ¤
- **ì»¬ë ‰ì…˜ ID:** `reservations`
- **í•„ë“œ:**
  - `userId` (ì˜¤ë¦„ì°¨ìˆœ)
  - `status` (ì˜¤ë¦„ì°¨ìˆœ)
  - `date` (ë‚´ë¦¼ì°¨ìˆœ)

---

## 5. ì•±ì—ì„œ í™•ì¸

### 5.1 ì•± ë¹Œë“œ ë° ì‹¤í–‰
```bash
./gradlew assembleDebug
./gradlew installDebug
```

### 5.2 ë¡œê·¸ì¸
1. ì•± ì‹¤í–‰
2. íšŒì›ê°€ì… ë˜ëŠ” ë¡œê·¸ì¸
3. ê°•ì˜ì‹¤ ëª©ë¡ í™”ë©´ì—ì„œ ì¶”ê°€í•œ ê°•ì˜ì‹¤ í™•ì¸

### 5.3 ê´€ë¦¬ì ê¶Œí•œ í…ŒìŠ¤íŠ¸
ê´€ë¦¬ì ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸í•œ ê²½ìš°:
- ê°•ì˜ì‹¤ ëª©ë¡ì—ì„œ **+** ë²„íŠ¼ì´ ë³´ì—¬ì•¼ í•¨
- ê°•ì˜ì‹¤ ì¶”ê°€ ê°€ëŠ¥

---

## ğŸ“ ì£¼ì˜ì‚¬í•­

### ë³´ì•ˆ
- **í…ŒìŠ¤íŠ¸ ëª¨ë“œ**ëŠ” 30ì¼ í›„ ìë™ìœ¼ë¡œ ë§Œë£Œë©ë‹ˆë‹¤
- í”„ë¡œë•ì…˜ ë°°í¬ ì „ì— ë°˜ë“œì‹œ **ë³´ì•ˆ ê·œì¹™ì„ ì„¤ì •**í•˜ì„¸ìš”
- ê´€ë¦¬ì ì´ë©”ì¼ ëª©ë¡ì„ ë³´ì•ˆ ê·œì¹™ì— í•˜ë“œì½”ë”©í•˜ëŠ” ëŒ€ì‹ , ë³„ë„ `admins` ì»¬ë ‰ì…˜ì„ ë§Œë“¤ì–´ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤

### ë°ì´í„° ë°±ì—…
- FirestoreëŠ” ìë™ ë°±ì—… ê¸°ëŠ¥ì´ ì—†ìŠµë‹ˆë‹¤
- ì¤‘ìš”í•œ ë°ì´í„°ëŠ” ì •ê¸°ì ìœ¼ë¡œ exportí•˜ì—¬ ë°±ì—…í•˜ì„¸ìš”

### ë¹„ìš©
- FirestoreëŠ” ì½ê¸°/ì“°ê¸°/ì‚­ì œ ì‘ì—…ì— ëŒ€í•´ ê³¼ê¸ˆë©ë‹ˆë‹¤
- ë¬´ë£Œ í• ë‹¹ëŸ‰: ì¼ì¼ ì½ê¸° 50,000ê±´, ì“°ê¸° 20,000ê±´
- [ìš”ê¸ˆ ì •ë³´](https://firebase.google.com/pricing)

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Q: ê°•ì˜ì‹¤ ëª©ë¡ì´ ë¹„ì–´ìˆì–´ìš”
A: Firestore Consoleì—ì„œ `rooms` ì»¬ë ‰ì…˜ì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

### Q: "Permission denied" ì˜¤ë¥˜ê°€ ë°œìƒí•´ìš”
A: ë³´ì•ˆ ê·œì¹™ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. Firestore ê·œì¹™ íƒ­ì—ì„œ ì‹œë®¬ë ˆì´í„°ë¡œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Q: ì˜ˆì•½ ìƒì„±ì´ ì•ˆ ë¼ìš”
A:
1. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
2. `reservations` ì»¬ë ‰ì…˜ì´ ìƒì„±ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
3. ë³´ì•ˆ ê·œì¹™ì—ì„œ `allow create` ê¶Œí•œ í™•ì¸

### Q: ì¸ë±ìŠ¤ ì˜¤ë¥˜ê°€ ë°œìƒí•´ìš”
A: ì˜¤ë¥˜ ë©”ì‹œì§€ì˜ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ Firebase Consoleì—ì„œ ìë™ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [Firebase Firestore ë¬¸ì„œ](https://firebase.google.com/docs/firestore)
- [Firestore ë³´ì•ˆ ê·œì¹™](https://firebase.google.com/docs/firestore/security/get-started)
- [Firestore ë°ì´í„° ëª¨ë¸ë§](https://firebase.google.com/docs/firestore/data-model)

---

**ë¬¸ì œê°€ í•´ê²°ë˜ì§€ ì•Šìœ¼ë©´ GitHub Issuesì— ë¬¸ì˜í•´ì£¼ì„¸ìš”!**
